plugins {
    id 'java-library'
}

group 'org.example'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

import com.entropy.rcp.srgconfig.tasks.*

ext {
    MC_VERSION = "a1.2.6"
    MCP_VERSION = "2.5"
    DIR_DATA = "$project.projectDir\\data"
    MAPPINGS_ZIP = "${DIR_DATA}\\mappings-mcp-${MCP_VERSION}.zip"
    RGS_FILE = "${DIR_DATA}\\${MC_VERSION}.rgs"
    SRG_FILE = "${DIR_DATA}\\${MC_VERSION}.srg"
    CLASS_CSV = "${DIR_DATA}\\csv\\classes_${MC_VERSION}.csv"
    FIELDS_CSV = "${DIR_DATA}\\csv\\fields_${MC_VERSION}.csv"
    METHODS_CSV = "${DIR_DATA}\\csv\\methods_${MC_VERSION}.csv"
}

clean {
    delete(file(RGS_FILE), file(SRG_FILE))
}

task extractRGSFile(type: Copy) {
    from zipTree(file(MAPPINGS_ZIP))
    into file(DIR_DATA)
}

task applyClassCSV(type: ApplyCSVTask) {
    scriptFile = file(RGS_FILE)
    csvFile = file(CLASS_CSV)
}

task convertToSRG(type: JavaExec) {
    main = "uk.jamierocks.rgs2srg.Main"
    classpath = files("${DIR_DATA}\\rgs2srg.jar")
    args("-i", RGS_FILE, "-o", SRG_FILE)
}

task applyFields(type: ApplyCSVTask) {
    scriptFile = file(SRG_FILE)
    csvFile = file(FIELDS_CSV)
}

task applyMethods(type: ApplyCSVTask) {
    scriptFile = file(SRG_FILE)
    csvFile = file(METHODS_CSV)
}